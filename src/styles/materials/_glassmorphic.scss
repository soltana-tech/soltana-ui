// ---------------------------------------------------------------------------
// Glassmorphic Design Utilities — "Crystal & Stained Glass"
// ---------------------------------------------------------------------------
// Multi-layer frosted glass, stained glass with theme tints and lead lines.
// Theme-aware via --glass-* and --stained-* custom properties.
// All glass elements set color: var(--text-primary) for consistent readability.
// ---------------------------------------------------------------------------

@use 'sass:list';
@use 'sass:string';
@use '../variables' as *;

/// Outputs a CSS rgb() call without Sass intercepting it.
@function css-rgb($channels, $alpha) {
  @return string.unquote('rgb(#{$channels} / #{$alpha}%)');
}

// ============================================================================
// BASE GLASS EFFECTS
// ============================================================================

.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(16px) saturate(140%);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

.glass-subtle {
  background: var(--glass-bg);
  backdrop-filter: blur(8px) saturate(120%);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 4px 16px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

.glass-strong {
  background: var(--glass-bg);
  backdrop-filter: blur(28px) saturate(160%);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 12px 48px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

// ============================================================================
// LUXURY & PREMIUM GLASS EFFECTS
// ============================================================================

.glass-luxury {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

.glass-frosted-heavy {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(32px) saturate(180%);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 12px 48px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

.glass-layered {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 4px 16px var(--glass-shadow),
    0 16px 48px rgb(0 0 0 / 15%),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

.glass-chrome {
  background: linear-gradient(
    145deg,
    var(--glass-gradient-start),
    var(--glass-gradient-end),
    var(--glass-inner-glow)
  );
  backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow),
    inset 0 -1px 0 rgb(0 0 0 / 10%);
  color: var(--text-primary);
}

// ============================================================================
// TINTED GLASS (jewel-toned)
// ============================================================================
// Vibrant jewel-toned glass with gradient depth for gem-like quality.

// Jewel glass mixin: 3-stop gradient with consistent blur/shadow structure.
// $light/$mid/$deep are RGB channel strings; opacity offsets allow warm vs cool tuning.
@mixin glass-jewel($light, $mid, $deep, $op-boost: 0) {
  background: linear-gradient(
    145deg,
    css-rgb($light, 20 + $op-boost) 0%,
    css-rgb($mid, 18 + $op-boost) 50%,
    css-rgb($deep, 16 + $op-boost) 100%
  );
  backdrop-filter: blur(14px) saturate(120%);
  border: 1px solid css-rgb($mid, 25 + $op-boost);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 css-rgb($light, 22 + $op-boost),
    inset 0 -1px 0 css-rgb($deep, 10);
  color: var(--text-primary);
}

.glass-gold {
  @include glass-jewel('254 243 199', '212 168 67', '184 134 11', 2);
}

.glass-emerald {
  @include glass-jewel('52 211 153', '16 185 129', '13 107 78');
}

.glass-sapphire {
  @include glass-jewel('96 165 250', '59 130 246', '30 64 175');
}

.glass-ruby {
  @include glass-jewel('248 113 113', '239 68 68', '153 27 27');
}

.glass-amethyst {
  @include glass-jewel('192 132 252', '168 85 247', '107 33 168');
}

.glass-citrine {
  @include glass-jewel('253 224 71', '232 200 64', '184 156 32', 2);
}

.glass-topaz {
  @include glass-jewel('251 191 36', '232 146 46', '184 110 26');
}

.glass-jade {
  @include glass-jewel('74 222 128', '46 168 122', '26 120 84');
}

.glass-turquoise {
  @include glass-jewel('94 234 212', '60 192 184', '34 138 132');
}

// Onyx and pearl have unique opacity/saturation profiles
.glass-onyx {
  background: linear-gradient(
    145deg,
    rgb(55 65 81 / 35%) 0%,
    rgb(26 28 46 / 30%) 50%,
    rgb(17 24 39 / 28%) 100%
  );
  backdrop-filter: blur(14px) saturate(110%);
  border: 1px solid rgb(55 65 81 / 30%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 rgb(107 114 128 / 15%),
    inset 0 -1px 0 rgb(0 0 0 / 20%);
  color: var(--text-primary);
}

.glass-pearl {
  background: linear-gradient(
    145deg,
    rgb(255 255 255 / 45%) 0%,
    rgb(240 236 248 / 40%) 50%,
    rgb(226 232 240 / 35%) 100%
  );
  backdrop-filter: blur(14px) saturate(110%);
  border: 1px solid rgb(226 232 240 / 50%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 rgb(255 255 255 / 60%),
    inset 0 -1px 0 rgb(203 213 225 / 20%);
  color: var(--text-primary);
}

// ============================================================================
// STAINED GLASS — theme-colored translucent panels
// ============================================================================

// Base stained glass: heavy blur + theme primary color tint + lead-line border
.glass-stained {
  background: linear-gradient(
    135deg,
    var(--stained-primary),
    var(--stained-secondary),
    var(--stained-accent)
  );
  backdrop-filter: blur(28px) saturate(160%);
  border: 2px solid rgb(40 35 30 / 40%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 20px rgb(255 255 255 / 5%),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
  position: relative;

  // Internal lead-line frame
  &::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1px solid rgb(40 35 30 / 20%);
    border-radius: inherit;
    pointer-events: none;
  }
}

// Gold cathedral glass
.glass-stained-gold {
  background: linear-gradient(
    135deg,
    rgb(212 168 67 / 15%) 0%,
    rgb(254 243 199 / 10%) 30%,
    rgb(184 134 11 / 12%) 60%,
    rgb(252 211 77 / 8%) 100%
  );
  backdrop-filter: blur(28px) saturate(170%);
  border: 2px solid rgb(100 80 30 / 35%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 24px rgb(212 168 67 / 8%),
    inset 0 1px 0 rgb(254 243 199 / 20%);
  color: var(--text-primary);
  position: relative;

  &::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1px solid rgb(100 80 30 / 18%);
    border-radius: inherit;
    pointer-events: none;
  }
}

// Multi-color jewel stained glass (cathedral window)
.glass-stained-jewel {
  background: linear-gradient(
    135deg,
    rgb(232 200 64 / 12%) 0%,
    rgb(16 185 129 / 10%) 25%,
    rgb(59 130 246 / 10%) 50%,
    rgb(239 68 68 / 8%) 75%,
    rgb(168 85 247 / 10%) 100%
  );
  backdrop-filter: blur(24px) saturate(180%);
  border: 2px solid rgb(40 35 30 / 45%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 28px rgb(255 255 255 / 4%);
  color: var(--text-primary);
  position: relative;

  &::after {
    content: '';
    position: absolute;
    inset: 6px;
    border: 1px solid rgb(40 35 30 / 15%);
    border-radius: inherit;
    pointer-events: none;
  }
}

// Rose window: radial gradient stained glass
.glass-stained-rose {
  background: radial-gradient(
    circle at 50% 50%,
    rgb(239 68 68 / 12%) 0%,
    rgb(168 85 247 / 10%) 25%,
    rgb(59 130 246 / 8%) 50%,
    rgb(16 185 129 / 10%) 75%,
    var(--stained-primary) 100%
  );
  backdrop-filter: blur(24px) saturate(170%);
  border: 2px solid rgb(40 35 30 / 40%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 30px rgb(255 255 255 / 3%);
  color: var(--text-primary);
  position: relative;

  // Concentric ring suggesting rose window structure
  &::after {
    content: '';
    position: absolute;
    inset: 20%;
    border: 1px solid rgb(40 35 30 / 15%);
    border-radius: var(--radius-full);
    pointer-events: none;
  }
}

// Lead-line grid overlay (can be combined with any stained glass)
.glass-stained-lead {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(0deg, rgb(40 35 30 / 12%) 1px, transparent 1px),
      linear-gradient(90deg, rgb(40 35 30 / 12%) 1px, transparent 1px);
    background-size: 40px 40px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// ============================================================================
// ENHANCED STAINED GLASS PATTERNS
// ============================================================================

// Cathedral — Tall vertical panels with Gothic arch tops
.glass-stained-cathedral {
  position: relative;
  background: linear-gradient(
    180deg,
    var(--stained-primary) 0%,
    var(--stained-secondary) 40%,
    var(--stained-accent) 70%,
    var(--stained-primary) 100%
  );
  backdrop-filter: blur(28px) saturate(170%);
  border: 2px solid rgb(40 35 30 / 45%);
  border-radius: 50% 50% var(--radius-lg) var(--radius-lg) / 15% 15% var(--radius-lg)
    var(--radius-lg);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 24px rgb(255 255 255 / 5%);
  color: var(--text-primary);

  // Vertical lead lines
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(90deg, transparent 32%, rgb(40 35 30 / 15%) 33%, transparent 34%),
      linear-gradient(90deg, transparent 65%, rgb(40 35 30 / 15%) 66%, transparent 67%);
    border-radius: inherit;
    pointer-events: none;
  }

  // Gothic arch frame
  &::after {
    content: '';
    position: absolute;
    inset: 6px;
    border: 1px solid rgb(40 35 30 / 20%);
    border-radius: inherit;
    pointer-events: none;
  }
}

// Medallion — Circular center pattern (rose window style)
.glass-stained-medallion {
  position: relative;
  background: radial-gradient(
    circle at 50% 50%,
    var(--stained-accent) 0%,
    var(--stained-secondary) 20%,
    var(--stained-primary) 40%,
    var(--stained-secondary) 60%,
    var(--stained-accent) 80%,
    var(--stained-primary) 100%
  );
  backdrop-filter: blur(26px) saturate(175%);
  border: 3px solid rgb(40 35 30 / 50%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 40px rgb(255 255 255 / 4%);
  color: var(--text-primary);

  // Concentric rings
  &::before {
    content: '';
    position: absolute;
    inset: 15%;
    border: 1px solid rgb(40 35 30 / 18%);
    border-radius: 50%;
    pointer-events: none;
  }

  &::after {
    content: '';
    position: absolute;
    inset: 35%;
    border: 1px solid rgb(40 35 30 / 15%);
    border-radius: 50%;
    pointer-events: none;
  }
}

// Mosaic — Small tile pattern overlay
.glass-stained-mosaic {
  position: relative;
  background: linear-gradient(
    135deg,
    var(--stained-primary),
    var(--stained-secondary),
    var(--stained-accent)
  );
  backdrop-filter: blur(24px) saturate(165%);
  border: 2px solid rgb(40 35 30 / 40%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 20px rgb(255 255 255 / 4%);
  color: var(--text-primary);

  // Small tile grid
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(0deg, rgb(40 35 30 / 10%) 1px, transparent 1px),
      linear-gradient(90deg, rgb(40 35 30 / 10%) 1px, transparent 1px);
    background-size: 16px 16px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// Triptych — Three-panel design
.glass-stained-triptych {
  position: relative;
  background: linear-gradient(
    90deg,
    var(--stained-primary) 0%,
    var(--stained-primary) 30%,
    var(--stained-secondary) 33%,
    var(--stained-secondary) 66%,
    var(--stained-accent) 69%,
    var(--stained-accent) 100%
  );
  backdrop-filter: blur(26px) saturate(170%);
  border: 2px solid rgb(40 35 30 / 45%);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 0 24px rgb(255 255 255 / 4%);
  color: var(--text-primary);

  // Panel dividers
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(90deg, transparent 32%, rgb(40 35 30 / 25%) 33%, transparent 34%),
      linear-gradient(90deg, transparent 65%, rgb(40 35 30 / 25%) 66%, transparent 67%);
    border-radius: inherit;
    pointer-events: none;
  }

  &::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1px solid rgb(40 35 30 / 15%);
    border-radius: inherit;
    pointer-events: none;
  }
}

// ============================================================================
// LEAD-LINE PATTERN VARIATIONS
// ============================================================================

// Gothic lead lines — Pointed arch patterns
.lead-gothic {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      repeating-linear-gradient(
        60deg,
        transparent 0,
        transparent 38px,
        rgb(40 35 30 / 12%) 40px,
        transparent 42px
      ),
      repeating-linear-gradient(
        -60deg,
        transparent 0,
        transparent 38px,
        rgb(40 35 30 / 12%) 40px,
        transparent 42px
      );
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// Art Nouveau lead lines — Flowing organic curves
.lead-art-nouveau {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cpath fill='none' stroke='rgb(40,35,30)' stroke-width='1' opacity='0.12' d='M0 40Q20 20 40 40T80 40 M0 80Q20 60 40 80T80 80 M40 0Q60 20 40 40T40 80'/%3E%3C/svg%3E");
    background-size: 80px 80px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// Geometric lead lines — Angular modern patterns
.lead-geometric {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(45deg, rgb(40 35 30 / 10%) 1px, transparent 1px),
      linear-gradient(-45deg, rgb(40 35 30 / 10%) 1px, transparent 1px),
      linear-gradient(0deg, rgb(40 35 30 / 8%) 1px, transparent 1px),
      linear-gradient(90deg, rgb(40 35 30 / 8%) 1px, transparent 1px);
    background-size: 30px 30px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// Celtic lead lines — Interlaced knot patterns
.lead-celtic {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Cpath fill='none' stroke='rgb(40,35,30)' stroke-width='1.5' opacity='0.1' d='M15 0Q30 15 15 30T15 60 M45 0Q30 15 45 30T45 60 M0 15Q15 30 0 45 M60 15Q45 30 60 45'/%3E%3C/svg%3E");
    background-size: 60px 60px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
}

// ============================================================================
// CUSTOMIZABLE STAINED GLASS COLORS
// ============================================================================
// Use CSS custom properties to define custom stained glass color schemes.
// Apply these classes alongside .glass-stained or any stained glass variant.

// Stained glass color presets (name, class-suffix, primary-rgb/op, secondary-rgb/op, accent-rgb/op)
$stained-presets: (
  'ruby-emerald': (
    ruby-emerald,
    '239 68 68 / 15%',
    '16 185 129 / 12%',
    '212 168 67 / 10%',
  ),
  'sapphire-gold': (
    sapphire-gold,
    '59 130 246 / 15%',
    '212 168 67 / 12%',
    '254 243 199 / 10%',
  ),
  'amethyst-rose': (
    amethyst-rose,
    '168 85 247 / 15%',
    '244 114 182 / 12%',
    '251 207 232 / 10%',
  ),
  'emerald-jade': (
    emerald-jade,
    '16 185 129 / 15%',
    '46 168 122 / 12%',
    '74 222 128 / 10%',
  ),
  'sunset': (
    sunset,
    '239 68 68 / 14%',
    '251 146 60 / 12%',
    '253 224 71 / 10%',
  ),
  'ocean': (
    ocean,
    '6 182 212 / 15%',
    '59 130 246 / 12%',
    '99 102 241 / 10%',
  ),
  'forest': (
    forest,
    '22 163 74 / 15%',
    '34 197 94 / 12%',
    '132 204 22 / 10%',
  ),
  'gold': (
    gold-mono,
    '212 168 67 / 18%',
    '184 134 11 / 14%',
    '254 243 199 / 12%',
  ),
);

@each $data-name, $vals in $stained-presets {
  [data-stained-colors='#{$data-name}'],
  .stained-#{list.nth($vals, 1)} {
    --stained-primary: #{string.unquote('rgb(#{list.nth($vals, 2)})')};
    --stained-secondary: #{string.unquote('rgb(#{list.nth($vals, 3)})')};
    --stained-accent: #{string.unquote('rgb(#{list.nth($vals, 4)})')};
  }
}

// ============================================================================
// STAINED GLASS BACKGROUND SYSTEM
// ============================================================================
// Complementary backgrounds that enhance stained glass elements.

// Bright backlight effect
.bg-stained-light {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 50% 30%, rgb(255 255 255 / 15%) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }
}

// Radial gradient from center
.bg-stained-gradient {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 50%, rgb(255 255 255 / 8%) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }
}

// Subtle texture for depth
.bg-stained-texture {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Crect width='1' height='1' fill='rgb(255,255,255)' opacity='0.03'/%3E%3C/svg%3E");
    background-size: 4px 4px;
    pointer-events: none;
    z-index: 0;
  }
}

// ============================================================================
// GLASS COMPONENTS
// ============================================================================

.glass-card {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(20px) saturate(140%);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl);
  box-shadow:
    0 8px 32px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  padding: 1.5rem;
  color: var(--text-primary);
  transition:
    box-shadow 0.3s ease,
    transform 0.3s ease;
}

.glass-nav {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
  box-shadow:
    0 2px 16px var(--glass-shadow),
    inset 0 -1px 0 rgb(0 0 0 / 5%);
  color: var(--text-primary);
}

.glass-button {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(12px) saturate(140%);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  box-shadow:
    0 4px 16px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
  cursor: pointer;
  transition:
    background 0.3s ease,
    box-shadow 0.3s ease,
    transform 0.2s ease;

  &:hover {
    background: linear-gradient(145deg, var(--glass-inner-glow), var(--glass-gradient-end));
    box-shadow:
      0 6px 24px var(--glass-shadow),
      inset 0 1px 0 var(--glass-inner-glow);
    transform: translateY(-1px);
  }

  &:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px var(--glass-shadow);
  }
}

.glass-input {
  background: var(--glass-bg);
  backdrop-filter: blur(8px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  padding: 0.625rem 1rem;
  color: var(--text-primary);
  font-family: var(--font-sans);
  font-size: var(--text-base);
  letter-spacing: var(--tracking-refined);
  transition:
    border-color 0.3s ease,
    box-shadow 0.3s ease;

  &::placeholder {
    color: var(--text-muted);
  }

  &:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow:
      0 0 0 3px var(--state-focus-ring),
      inset 0 1px 0 var(--glass-inner-glow);
  }
}

// ============================================================================
// GLASS OVERLAYS & MODALS
// ============================================================================

.glass-overlay {
  background: rgb(0 0 0 / 50%);
  backdrop-filter: blur(6px);
}

.glass-modal {
  background: linear-gradient(145deg, var(--glass-gradient-start), var(--glass-gradient-end));
  backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl);
  box-shadow:
    0 24px 64px var(--glass-shadow),
    inset 0 1px 0 var(--glass-inner-glow);
  color: var(--text-primary);
}

// ============================================================================
// BACKDROP BLUR UTILITIES
// ============================================================================

$blur-scale: (
  sm: 4px,
  default: 8px,
  md: 12px,
  lg: 16px,
  xl: 24px,
  2xl: 40px,
);

@each $name, $val in $blur-scale {
  @if $name == 'default' {
    .blur {
      backdrop-filter: blur($val);
    }
  } @else {
    .blur-#{$name} {
      backdrop-filter: blur($val);
    }
  }
}

.blur-none {
  backdrop-filter: none;
}
