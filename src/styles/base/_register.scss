@use 'sass:list';
@use 'sass:string';
@use '../variables' as vars;

// ---------------------------------------------------------------------------
// Tier Registration Mixins
// ---------------------------------------------------------------------------
// Emit dual-selector blocks (data-attribute + utility class) for custom tier
// values from a single @content block.
// ---------------------------------------------------------------------------

// Theme: [data-theme] + .theme-* selectors.
// Does NOT include :root — that is reserved for the default theme.
@mixin register-theme($name) {
  [data-theme='#{$name}'],
  .theme-#{$name} {
    @content;
  }
}

// Relief: [data-relief] + .relief-* selectors.
@mixin register-relief($name) {
  [data-relief='#{$name}'],
  .relief-#{$name} {
    @content;
  }
}

// Finish: [data-finish] + .finish-* selectors.
@mixin register-finish($name) {
  [data-finish='#{$name}'],
  .finish-#{$name} {
    @content;
  }
}

// Ornament: :where([data-ornament]) for zero-specificity config cascade,
// plus .ornament-* for per-element overrides.
@mixin register-ornament($name) {
  @if not list.index(vars.$ornament-names, $name) {
    @warn "Ornament '#{$name}' is not in $ornament-names — per-element override selectors will not be generated.";
  }

  :where([data-ornament='#{$name}']) {
    @content;
  }

  .ornament-#{$name} {
    @content;
  }
}

// Ornament consume selectors: emits both the config-default :where() selector
// and per-element .ornament-* override selectors for a given component class.
@mixin ornament-consume-selectors($class, $state: null) {
  $state-suffix: '';
  @if $state {
    $state-suffix: ':#{$state}';
  }

  :where([data-ornament]:not([data-ornament='none'])) .#{$class}#{$state-suffix} {
    @content;
  }

  $sel: ();
  @each $name in vars.$ornament-names {
    $sel: list.append($sel, string.unquote('.ornament-#{$name} .#{$class}#{$state-suffix}'), comma);
    $sel: list.append($sel, string.unquote('.#{$class}.ornament-#{$name}#{$state-suffix}'), comma);
  }
  #{$sel} {
    @content;
  }
}

// ---------------------------------------------------------------------------
// Shared Property Mixins
// ---------------------------------------------------------------------------

@mixin finish-surface($bg: var(--relief-bg)) {
  background-color: color-mix(in srgb, #{$bg} calc(var(--finish-opacity, 1) * 100%), transparent);
  background-image: var(--finish-sheen, none), var(--finish-overlay, none);
  backdrop-filter: blur(var(--finish-blur)) saturate(var(--finish-saturation));
}

@mixin mask($image, $size: null, $repeat: null, $position: null) {
  -webkit-mask-image: $image;
  mask-image: $image;
  @if $size {
    -webkit-mask-size: $size;
    mask-size: $size;
  }
  @if $repeat {
    -webkit-mask-repeat: $repeat;
    mask-repeat: $repeat;
  }
  @if $position {
    -webkit-mask-position: $position;
    mask-position: $position;
  }
}
